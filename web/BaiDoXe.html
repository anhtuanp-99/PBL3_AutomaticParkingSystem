<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Qu·∫£n L√Ω B√£i ƒê·ªó Xe T·ª± ƒê·ªông</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .parking-spot {
            transition: all 0.3s ease;
        }
        .parking-spot.occupied {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
            color: white;
        }
        .parking-spot.available {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            color: white;
        }
        .status-card {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        .temp-card {
            background: linear-gradient(135deg, #6366f1, #4338ca);
        }
        .update-card {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                üöó H·ªá Th·ªëng Qu·∫£n L√Ω B√£i ƒê·ªó Xe T·ª± ƒê·ªông
            </h1>
            <p class="text-gray-600">Gi√°m s√°t v√† qu·∫£n l√Ω b√£i ƒë·ªó xe th√¥ng minh</p>
        </div>

        <!-- Dashboard Card -->
        <div class="bg-white rounded-xl p-6 mb-6 shadow-lg border border-gray-200">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Status Section -->
                <div class="text-center border-r border-gray-200 last:border-r-0">
                    <div class="text-3xl mb-2">üÖøÔ∏è</div>
                    <p class="text-lg font-semibold text-gray-700 mb-1">B√£i ƒê·ªó</p>
                    <p class="text-3xl font-bold text-blue-600" id="availableSpots">4</p>
                    <p class="text-sm text-gray-500">ch·ªó tr·ªëng / 6</p>
                </div>

                <!-- Temperature Section -->
                <div class="text-center border-r border-gray-200 last:border-r-0">
                    <div class="text-3xl mb-2">üå°Ô∏è</div>
                    <p class="text-lg font-semibold text-gray-700 mb-1">Nhi·ªát ƒê·ªô</p>
                    <p class="text-3xl font-bold text-purple-600" id="temperature">28¬∞C</p>
                    <p class="text-sm text-gray-500">ESP32</p>
                </div>

                <!-- Date Time Section -->
                <div class="text-center">
                    <div class="text-3xl mb-2">üïê</div>
                    <p class="text-lg font-semibold text-gray-700 mb-1">C·∫≠p Nh·∫≠t</p>
                    <p class="text-2xl font-bold text-orange-600" id="currentTime">--:--:--</p>
                    <p class="text-sm text-gray-500" id="currentDate">--</p>
                </div>
            </div>
        </div>

        <!-- Parking Layout -->
        <div class="bg-white rounded-xl p-6 mb-8 shadow-lg border border-gray-200">
            <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">S∆° ƒê·ªì B√£i ƒê·ªó Xe & Camera Gi√°m S√°t</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Left Side - Parking Status -->
                <div>
                    <h3 class="text-lg font-semibold mb-4 text-gray-700 text-center">üìç Tr·∫°ng Th√°i Ch·ªó ƒê·ªó</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="parking-spot available rounded-lg p-4 text-center cursor-pointer border-2 border-green-200" data-spot="1">
                            <div class="text-2xl mb-2">üöó</div>
                            <div class="font-semibold">Ch·ªó 1</div>
                            <div class="text-sm opacity-80">Tr·ªëng</div>
                        </div>
                        <div class="parking-spot occupied rounded-lg p-4 text-center cursor-pointer border-2 border-red-200" data-spot="2">
                            <div class="text-2xl mb-2">üöô</div>
                            <div class="font-semibold">Ch·ªó 2</div>
                            <div class="text-sm opacity-80">C√≥ xe</div>
                        </div>
                        <div class="parking-spot available rounded-lg p-4 text-center cursor-pointer border-2 border-green-200" data-spot="3">
                            <div class="text-2xl mb-2">üöó</div>
                            <div class="font-semibold">Ch·ªó 3</div>
                            <div class="text-sm opacity-80">Tr·ªëng</div>
                        </div>
                        <div class="parking-spot occupied rounded-lg p-4 text-center cursor-pointer border-2 border-red-200" data-spot="4">
                            <div class="text-2xl mb-2">üöê</div>
                            <div class="font-semibold">Ch·ªó 4</div>
                            <div class="text-sm opacity-80">C√≥ xe</div>
                        </div>
                        <div class="parking-spot available rounded-lg p-4 text-center cursor-pointer border-2 border-green-200" data-spot="5">
                            <div class="text-2xl mb-2">üöó</div>
                            <div class="font-semibold">Ch·ªó 5</div>
                            <div class="text-sm opacity-80">Tr·ªëng</div>
                        </div>
                        <div class="parking-spot available rounded-lg p-4 text-center cursor-pointer border-2 border-green-200" data-spot="6">
                            <div class="text-2xl mb-2">üöó</div>
                            <div class="font-semibold">Ch·ªó 6</div>
                            <div class="text-sm opacity-80">Tr·ªëng</div>
                        </div>
                    </div>
                </div>
                
                <!-- Right Side - Camera Feed -->
                <div>
                    <h3 class="text-lg font-semibold mb-4 text-gray-700 text-center">üìπ Camera ESP32-CAM</h3>
                    <div class="bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 aspect-video flex flex-col items-center justify-center text-gray-500">
                        <div class="text-6xl mb-4">üì∑</div>
                        <div class="text-lg font-medium mb-2">ESP32-CAM Feed</div>
                        <div class="text-sm text-center px-4">
                            Khu v·ª±c n√†y s·∫Ω hi·ªÉn th·ªã video tr·ª±c ti·∫øp t·ª´ camera ESP32-CAM khi ƒë∆∞·ª£c k·∫øt n·ªëi
                        </div>
                        <div class="mt-4 px-4 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium">
                            üîó Ch·ªù k·∫øt n·ªëi camera...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts & Data Table Combined -->
        <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-200">
            <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">üìä Bi·ªÉu ƒê·ªì & L·ªãch S·ª≠ ƒê·ªó Xe</h2>
            <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                <!-- Left Side - Charts -->
                <div>
                    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-4 gap-3">
                        <h3 class="text-lg font-semibold text-gray-700">üìà Bi·ªÉu ƒê·ªì S·ª≠ D·ª•ng</h3>
                        <div class="flex flex-wrap items-center gap-2">
                            <select id="chartFilter" class="px-2 py-1 bg-gray-50 border border-gray-300 rounded text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="updateChart()">
                                <option value="hour">Theo gi·ªù</option>
                                <option value="day">Theo ng√†y</option>
                                <option value="week">Theo tu·∫ßn</option>
                                <option value="month">Theo th√°ng</option>
                            </select>
                            <input type="date" id="startDate" class="px-2 py-1 bg-gray-50 border border-gray-300 rounded text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <input type="date" id="endDate" class="px-2 py-1 bg-gray-50 border border-gray-300 rounded text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button onclick="filterChartData()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded font-medium text-sm transition-colors">
                                üîç
                            </button>
                        </div>
                    </div>
                    <canvas id="usageChart" width="400" height="300"></canvas>
                    <div id="chartDateRange" class="mt-3 text-center text-gray-600 text-sm font-medium"></div>
                </div>
                
                <!-- Right Side - Data Table -->
                <div>
                    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-4 gap-3">
                        <h3 class="text-lg font-semibold text-gray-700">üìã L·ªãch S·ª≠ G·∫ßn ƒê√¢y</h3>
                        <div class="flex items-center gap-2">
                            <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm..." class="px-3 py-1 bg-gray-50 border border-gray-300 rounded text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-32" oninput="searchData()">
                            <select id="statusFilter" class="px-2 py-1 bg-gray-50 border border-gray-300 rounded text-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="searchData()">
                                <option value="all">T·∫•t c·∫£</option>
                                <option value="occupied">ƒêang ƒë·ªó</option>
                                <option value="completed">Ho√†n th√†nh</option>
                            </select>
                        </div>
                    </div>
                    <div class="overflow-x-auto max-h-96 overflow-y-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="sticky top-0 bg-white">
                                <tr class="border-b-2 border-gray-200 bg-gray-50">
                                    <th class="pb-2 pt-2 px-3 font-semibold text-gray-700">üöó Ch·ªó</th>
                                    <th class="pb-2 pt-2 px-3 font-semibold text-gray-700">‚è∞ V√†o</th>
                                    <th class="pb-2 pt-2 px-3 font-semibold text-gray-700">üö™ Ra</th>
                                    <th class="pb-2 pt-2 px-3 font-semibold text-gray-700">‚è±Ô∏è Th·ªùi gian</th>
                                    <th class="pb-2 pt-2 px-3 font-semibold text-gray-700">üìä Tr·∫°ng th√°i</th>
                                </tr>
                            </thead>
                            <tbody id="dataTable">
                                <tr class="border-b border-gray-100 bg-blue-50 hover:bg-blue-100">
                                    <td class="py-2 px-3 text-blue-800 font-medium">Ch·ªó 2</td>
                                    <td class="py-2 px-3 text-blue-700">08:30</td>
                                    <td class="py-2 px-3 text-blue-700">-</td>
                                    <td class="py-2 px-3 text-blue-700">2h 15m</td>
                                    <td class="py-2 px-3"><span class="bg-red-500 text-white px-2 py-1 rounded-full text-xs font-semibold">ƒêang ƒë·ªó</span></td>
                                </tr>
                                <tr class="border-b border-gray-100 bg-blue-50 hover:bg-blue-100">
                                    <td class="py-2 px-3 text-blue-800 font-medium">Ch·ªó 4</td>
                                    <td class="py-2 px-3 text-blue-700">09:15</td>
                                    <td class="py-2 px-3 text-blue-700">-</td>
                                    <td class="py-2 px-3 text-blue-700">1h 30m</td>
                                    <td class="py-2 px-3"><span class="bg-red-500 text-white px-2 py-1 rounded-full text-xs font-semibold">ƒêang ƒë·ªó</span></td>
                                </tr>
                                <tr class="border-b border-gray-100 hover:bg-gray-50">
                                    <td class="py-2 px-3 text-gray-800">Ch·ªó 1</td>
                                    <td class="py-2 px-3 text-gray-600">07:00</td>
                                    <td class="py-2 px-3 text-gray-600">09:30</td>
                                    <td class="py-2 px-3 text-gray-600">2h 30m</td>
                                    <td class="py-2 px-3"><span class="bg-green-500 text-white px-2 py-1 rounded-full text-xs font-semibold">Ho√†n th√†nh</span></td>
                                </tr>
                                <tr class="border-b border-gray-100 hover:bg-gray-50">
                                    <td class="py-2 px-3 text-gray-800">Ch·ªó 3</td>
                                    <td class="py-2 px-3 text-gray-600">06:45</td>
                                    <td class="py-2 px-3 text-gray-600">08:15</td>
                                    <td class="py-2 px-3 text-gray-600">1h 30m</td>
                                    <td class="py-2 px-3"><span class="bg-green-500 text-white px-2 py-1 rounded-full text-xs font-semibold">Ho√†n th√†nh</span></td>
                                </tr>
                                <tr class="border-b border-gray-100 hover:bg-gray-50">
                                    <td class="py-2 px-3 text-gray-800">Ch·ªó 5</td>
                                    <td class="py-2 px-3 text-gray-600">05:30</td>
                                    <td class="py-2 px-3 text-gray-600">07:45</td>
                                    <td class="py-2 px-3 text-gray-600">2h 15m</td>
                                    <td class="py-2 px-3"><span class="bg-green-500 text-white px-2 py-1 rounded-full text-xs font-semibold">Ho√†n th√†nh</span></td>
                                </tr>
                                <tr class="border-b border-gray-100 hover:bg-gray-50">
                                    <td class="py-2 px-3 text-gray-800">Ch·ªó 6</td>
                                    <td class="py-2 px-3 text-gray-600">04:15</td>
                                    <td class="py-2 px-3 text-gray-600">06:30</td>
                                    <td class="py-2 px-3 text-gray-600">2h 15m</td>
                                    <td class="py-2 px-3"><span class="bg-green-500 text-white px-2 py-1 rounded-full text-xs font-semibold">Ho√†n th√†nh</span></td>
                                </tr>
                                <tr class="border-b border-gray-100 hover:bg-gray-50">
                                    <td class="py-2 px-3 text-gray-800">Ch·ªó 1</td>
                                    <td class="py-2 px-3 text-gray-600">03:00</td>
                                    <td class="py-2 px-3 text-gray-600">05:45</td>
                                    <td class="py-2 px-3 text-gray-600">2h 45m</td>
                                    <td class="py-2 px-3"><span class="bg-green-500 text-white px-2 py-1 rounded-full text-xs font-semibold">Ho√†n th√†nh</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data for parking management
        let parkingData = [
            {id: 1, licensePlate: '29A-12345', spot: 2, checkIn: '08:30', checkOut: null, fee: 45000, status: 'occupied'},
            {id: 2, licensePlate: '30B-67890', spot: 4, checkIn: '09:15', checkOut: null, fee: 30000, status: 'occupied'},
            {id: 3, licensePlate: '51C-11111', spot: 1, checkIn: '07:00', checkOut: '09:30', fee: 50000, status: 'completed'},
            {id: 4, licensePlate: '43D-22222', spot: 3, checkIn: '06:45', checkOut: '08:15', fee: 30000, status: 'completed'},
            {id: 5, licensePlate: '29E-33333', spot: 5, checkIn: '05:30', checkOut: '07:45', fee: 45000, status: 'completed'}
        ];

        // Chart data for different time periods - usage rate only
        const chartData = {
            hour: {
                labels: ['6h', '7h', '8h', '9h', '10h', '11h', '12h', '13h', '14h', '15h', '16h', '17h'],
                data: [17, 50, 67, 83, 67, 50, 100, 83, 67, 50, 33, 17],
                label: 'T·ª∑ l·ªá s·ª≠ d·ª•ng (%)',
                dateRange: '14/12/2024'
            },
            day: {
                labels: ['14/12', '15/12', '16/12', '17/12', '18/12', '19/12', '20/12'],
                data: [65, 78, 72, 85, 92, 88, 70],
                label: 'T·ª∑ l·ªá s·ª≠ d·ª•ng (%)',
                dateRange: '14/12/2024 - 20/12/2024'
            },
            week: {
                labels: ['Tu·∫ßn 1', 'Tu·∫ßn 2', 'Tu·∫ßn 3', 'Tu·∫ßn 4'],
                data: [72, 85, 78, 90],
                label: 'T·ª∑ l·ªá s·ª≠ d·ª•ng (%)',
                dateRange: '25/11/2024 - 22/12/2024'
            },
            month: {
                labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
                data: [68, 75, 72, 82, 88, 92, 89, 95, 78, 85, 80, 73],
                label: 'T·ª∑ l·ªá s·ª≠ d·ª•ng (%)',
                dateRange: '01/01/2024 - 31/12/2024'
            }
        };

        let usageChart;

        // Initialize charts
        function initCharts() {
            // Usage Chart
            const usageCtx = document.getElementById('usageChart').getContext('2d');
            usageChart = new Chart(usageCtx, {
                type: 'line',
                data: {
                    labels: chartData.hour.labels,
                    datasets: [{
                        label: chartData.hour.label,
                        data: chartData.hour.data,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#1d4ed8',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#374151',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#374151',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#374151',
                                font: {
                                    size: 12,
                                    weight: '500'
                                },
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(156, 163, 175, 0.3)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#374151',
                                font: {
                                    size: 12,
                                    weight: '500'
                                }
                            },
                            grid: {
                                color: 'rgba(156, 163, 175, 0.3)'
                            }
                        }
                    }
                }
            });
        }

        // Update chart based on filter selection
        function updateChart() {
            const filterValue = document.getElementById('chartFilter').value;
            const selectedData = chartData[filterValue];
            
            usageChart.data.labels = selectedData.labels;
            usageChart.data.datasets[0].data = selectedData.data;
            usageChart.data.datasets[0].label = selectedData.label;
            usageChart.update();
            
            // Update date range display
            document.getElementById('chartDateRange').textContent = selectedData.dateRange;
        }
        
        // Filter chart data by date range
        function filterChartData() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const filterValue = document.getElementById('chartFilter').value;
            
            if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const startFormatted = start.toLocaleDateString('vi-VN');
                const endFormatted = end.toLocaleDateString('vi-VN');
                
                document.getElementById('chartDateRange').textContent = `${startFormatted} - ${endFormatted}`;
                
                // Simulate filtered data (in real app, this would filter actual data)
                const selectedData = chartData[filterValue];
                usageChart.data.labels = selectedData.labels;
                usageChart.data.datasets[0].data = selectedData.data.map(val => Math.floor(val * (0.7 + Math.random() * 0.6)));
                usageChart.update();
            } else {
                updateChart();
            }
        }
        
        // Search function for data table
        function searchData() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            
            let filteredData = [...parkingData];
            
            // Filter by search term
            if (searchTerm) {
                filteredData = filteredData.filter(record => 
                    record.spot.toString().includes(searchTerm) ||
                    record.licensePlate.toLowerCase().includes(searchTerm) ||
                    record.checkIn.includes(searchTerm) ||
                    (record.checkOut && record.checkOut.includes(searchTerm))
                );
            }
            
            // Filter by status
            if (statusFilter !== 'all') {
                filteredData = filteredData.filter(record => record.status === statusFilter);
            }
            
            updateDataTableWithFilter(filteredData);
        }

        // Simulate temperature updates from ESP32
        function updateTemperature() {
            const temp = Math.floor(Math.random() * 10) + 25; // 25-35¬∞C
            document.getElementById('temperature').textContent = temp + '¬∞C';
        }

        // Update current date and time
        function updateDateTime() {
            const now = new Date();
            const timeOptions = { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                hour12: false
            };
            
            const dateOptions = {
                weekday: 'short',
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            };
            
            // Display current real date and time
            document.getElementById('currentDate').textContent = now.toLocaleDateString('vi-VN', dateOptions);
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('vi-VN', timeOptions);
        }

        // Update parking spot status
        function updateParkingStatus() {
            const spots = document.querySelectorAll('.parking-spot');
            let availableCount = 0;
            
            spots.forEach(spot => {
                if (spot.classList.contains('available')) {
                    availableCount++;
                }
            });
            
            document.getElementById('availableSpots').textContent = availableCount;
        }

        // Toggle parking spot status
        function toggleParkingSpot(spotElement) {
            const spotNumber = spotElement.dataset.spot;
            const statusText = spotElement.querySelector('.text-sm');
            
            if (spotElement.classList.contains('available')) {
                spotElement.classList.remove('available');
                spotElement.classList.add('occupied');
                spotElement.classList.remove('border-green-200');
                spotElement.classList.add('border-red-200');
                statusText.textContent = 'C√≥ xe';
                
                // Add new parking record
                const newRecord = {
                    id: Date.now(),
                    licensePlate: generateLicensePlate(),
                    spot: parseInt(spotNumber),
                    checkIn: new Date().toLocaleTimeString('vi-VN', {hour: '2-digit', minute: '2-digit'}),
                    checkOut: null,
                    fee: 0,
                    status: 'occupied'
                };
                parkingData.unshift(newRecord);
            } else {
                spotElement.classList.remove('occupied');
                spotElement.classList.add('available');
                spotElement.classList.remove('border-red-200');
                spotElement.classList.add('border-green-200');
                statusText.textContent = 'Tr·ªëng';
                
                // Update existing record
                const record = parkingData.find(r => r.spot === parseInt(spotNumber) && r.status === 'occupied');
                if (record) {
                    record.checkOut = new Date().toLocaleTimeString('vi-VN', {hour: '2-digit', minute: '2-digit'});
                    record.status = 'completed';
                    record.fee = Math.floor(Math.random() * 50000) + 20000; // Random fee 20k-70k
                }
            }
            
            updateParkingStatus();
            updateDataTable();
        }

        // Generate random license plate
        function generateLicensePlate() {
            const prefixes = ['29A', '30B', '51C', '43D', '77E', '88F'];
            const numbers = Math.floor(Math.random() * 90000) + 10000;
            return prefixes[Math.floor(Math.random() * prefixes.length)] + '-' + numbers;
        }

        // Update data table with filtered data
        function updateDataTableWithFilter(filteredData) {
            const tableBody = document.getElementById('dataTable');
            tableBody.innerHTML = '';
            
            if (filteredData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" class="py-8 px-4 text-center text-gray-500">
                        <div class="text-4xl mb-2">üîç</div>
                        <div class="font-medium">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu ph√π h·ª£p</div>
                        <div class="text-sm">Th·ª≠ thay ƒë·ªïi ƒëi·ªÅu ki·ªán l·ªçc</div>
                    </td>
                `;
                tableBody.appendChild(row);
                return;
            }
            
            // Sort filtered data: occupied spots (1-6) first, then completed by most recent
            const sortedFilteredData = [...filteredData].sort((a, b) => {
                // First priority: occupied status for spots 1-6
                const aIsCurrentOccupied = a.spot >= 1 && a.spot <= 6 && a.status === 'occupied';
                const bIsCurrentOccupied = b.spot >= 1 && b.spot <= 6 && b.status === 'occupied';
                
                if (aIsCurrentOccupied && !bIsCurrentOccupied) return -1;
                if (!aIsCurrentOccupied && bIsCurrentOccupied) return 1;
                
                // If both are current occupied or both are not, sort by ID (most recent first)
                return b.id - a.id;
            });
            
            sortedFilteredData.slice(0, 10).forEach(record => {
                const row = document.createElement('tr');
                
                // Add blue background for current parking spots (1-6) with occupied status
                const isCurrentSpot = record.spot >= 1 && record.spot <= 6 && record.status === 'occupied';
                const rowClass = isCurrentSpot 
                    ? 'border-b border-gray-100 bg-blue-50 hover:bg-blue-100' 
                    : 'border-b border-gray-100 hover:bg-gray-50';
                
                row.className = rowClass;
                
                const duration = record.checkOut ? calculateDuration(record.checkIn, record.checkOut) : calculateDuration(record.checkIn, new Date().toLocaleTimeString('vi-VN', {hour: '2-digit', minute: '2-digit'}));
                const statusClass = record.status === 'occupied' ? 'bg-red-500' : 'bg-green-500';
                const statusText = record.status === 'occupied' ? 'ƒêang ƒë·ªó' : 'Ho√†n th√†nh';
                
                // Add blue text for current spots
                const textClass = isCurrentSpot ? 'text-blue-800 font-medium' : 'text-gray-800';
                const subTextClass = isCurrentSpot ? 'text-blue-700' : 'text-gray-600';
                
                row.innerHTML = `
                    <td class="py-2 px-3 ${textClass}">Ch·ªó ${record.spot}</td>
                    <td class="py-2 px-3 ${subTextClass}">${record.checkIn}</td>
                    <td class="py-2 px-3 ${subTextClass}">${record.checkOut || '-'}</td>
                    <td class="py-2 px-3 ${subTextClass}">${duration}</td>
                    <td class="py-2 px-3"><span class="${statusClass} text-white px-2 py-1 rounded-full text-xs font-semibold">${statusText}</span></td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Update data table
        function updateDataTable() {
            const tableBody = document.getElementById('dataTable');
            tableBody.innerHTML = '';
            
            // Sort data: occupied spots (1-6) first, then completed by most recent
            const sortedData = [...parkingData].sort((a, b) => {
                // First priority: occupied status for spots 1-6
                const aIsCurrentOccupied = a.spot >= 1 && a.spot <= 6 && a.status === 'occupied';
                const bIsCurrentOccupied = b.spot >= 1 && b.spot <= 6 && b.status === 'occupied';
                
                if (aIsCurrentOccupied && !bIsCurrentOccupied) return -1;
                if (!aIsCurrentOccupied && bIsCurrentOccupied) return 1;
                
                // If both are current occupied or both are not, sort by ID (most recent first)
                return b.id - a.id;
            });
            
            sortedData.slice(0, 10).forEach(record => {
                const row = document.createElement('tr');
                
                // Add blue background for current parking spots (1-6) with occupied status
                const isCurrentSpot = record.spot >= 1 && record.spot <= 6 && record.status === 'occupied';
                const rowClass = isCurrentSpot 
                    ? 'border-b border-gray-100 bg-blue-50 hover:bg-blue-100' 
                    : 'border-b border-gray-100 hover:bg-gray-50';
                
                row.className = rowClass;
                
                const duration = record.checkOut ? calculateDuration(record.checkIn, record.checkOut) : calculateDuration(record.checkIn, new Date().toLocaleTimeString('vi-VN', {hour: '2-digit', minute: '2-digit'}));
                const statusClass = record.status === 'occupied' ? 'bg-red-500' : 'bg-green-500';
                const statusText = record.status === 'occupied' ? 'ƒêang ƒë·ªó' : 'Ho√†n th√†nh';
                
                // Add blue text for current spots
                const textClass = isCurrentSpot ? 'text-blue-800 font-medium' : 'text-gray-800';
                const subTextClass = isCurrentSpot ? 'text-blue-700' : 'text-gray-600';
                
                row.innerHTML = `
                    <td class="py-2 px-3 ${textClass}">Ch·ªó ${record.spot}</td>
                    <td class="py-2 px-3 ${subTextClass}">${record.checkIn}</td>
                    <td class="py-2 px-3 ${subTextClass}">${record.checkOut || '-'}</td>
                    <td class="py-2 px-3 ${subTextClass}">${duration}</td>
                    <td class="py-2 px-3"><span class="${statusClass} text-white px-2 py-1 rounded-full text-xs font-semibold">${statusText}</span></td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Calculate duration between two times
        function calculateDuration(startTime, endTime) {
            const start = new Date(`2024-01-01 ${startTime}`);
            const end = new Date(`2024-01-01 ${endTime}`);
            const diff = Math.abs(end - start);
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            return `${hours}h ${minutes}m`;
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set default dates
            const today = new Date();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
            document.getElementById('startDate').value = weekAgo.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            
            // Add click events to parking spots
            document.querySelectorAll('.parking-spot').forEach(spot => {
                spot.addEventListener('click', () => toggleParkingSpot(spot));
            });
            
            // Initialize charts
            initCharts();
            
            // Update initial status
            updateParkingStatus();
            updateDataTable();
            updateDateTime();
            updateChart(); // Initialize chart with date range
            
            // Simulate real-time updates
            setInterval(updateTemperature, 5000); // Update temperature every 5 seconds
            setInterval(updateDateTime, 1000); // Update date/time every second
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'982b2e1e823036f1',t:'MTc1ODQ3NDY3MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
